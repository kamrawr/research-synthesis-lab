<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Underemployment & Career Trajectories | Research Synthesis Lab</title>
    <link rel="stylesheet" href="../../assets/style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .explorer-header {
            background: linear-gradient(135deg, #dc2626 0%, #ea580c 100%);
            color: white;
            padding: 60px 20px;
        }
        
        .back-link {
            color: white;
            opacity: 0.9;
            text-decoration: none;
            margin-bottom: 20px;
            display: inline-block;
        }
        
        .back-link:hover {
            opacity: 1;
            text-decoration: underline;
        }
        
        .explorer-header h1 {
            font-size: 2.5em;
            margin-bottom: 16px;
        }
        
        .tabs {
            display: flex;
            gap: 8px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .tab-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .tab-btn.active {
            background: white;
            color: #dc2626;
        }
        
        .tab-panel {
            display: none;
            padding: 40px 20px;
        }
        
        .tab-panel.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .key-finding {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid #dc2626;
        }
        
        .key-finding h3 {
            color: #dc2626;
            margin-bottom: 12px;
        }
        
        .stat-box {
            background: white;
            padding: 32px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 3em;
            font-weight: 700;
            color: #dc2626;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #4b5563;
            font-size: 1.1em;
        }
        
        .viz-container {
            background: white;
            padding: 32px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        .viz-title {
            font-size: 1.5em;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
        }
        
        .bar {
            transition: all 0.3s;
        }
        
        .bar:hover {
            opacity: 0.8;
        }
        
        .axis text {
            font-size: 12px;
        }
        
        .axis line, .axis path {
            stroke: #9ca3af;
        }
        
        .tooltip {
            position: absolute;
            padding: 12px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 8px;
            pointer-events: none;
            font-size: 14px;
            z-index: 1000;
            max-width: 300px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .data-table th {
            background: #f3f4f6;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .data-table tr:hover {
            background: #f9fafb;
        }
        
        .highlight-high {
            background: #fee2e2;
            font-weight: 600;
        }
        
        .highlight-low {
            background: #dcfce7;
            font-weight: 600;
        }
        
        .insight-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .insight-box h4 {
            color: #92400e;
            margin-bottom: 10px;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: 700;
            color: #1f2937;
        }
        
        .metric-change {
            font-size: 0.85em;
            margin-top: 8px;
        }
        
        .positive {
            color: #059669;
        }
        
        .negative {
            color: #dc2626;
        }
    </style>
</head>
<body>
    <div class="explorer-header">
        <div class="container">
            <a href="../../index.html" class="back-link">← Back to Lab</a>
            <h1>College Underemployment & Long-Term Career Trajectories</h1>
            <p>Analysis of 7,703 institutions • 24 fields of study • October 2025</p>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('summary')">Summary</button>
                <button class="tab-btn" onclick="switchTab('findings')">Key Findings</button>
                <button class="tab-btn" onclick="switchTab('field-risk')">Field Risk</button>
                <button class="tab-btn" onclick="switchTab('completion')">Completion Gradient</button>
                <button class="tab-btn" onclick="switchTab('institutions')">Institution Effects</button>
                <button class="tab-btn" onclick="switchTab('ses')">SES Stratification</button>
                <button class="tab-btn" onclick="switchTab('scarring')">Career Scarring</button>
                <button class="tab-btn" onclick="switchTab('data')">Raw Data</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Summary Tab -->
        <div id="summary" class="tab-panel active">
            <h2>Research Question</h2>
            <div class="key-finding">
                <p style="font-size: 1.2em; line-height: 1.8;">
                    <strong>Does initial underemployment causally determine long-term earnings trajectories, 
                    or do graduates recover over time?</strong> This analysis examines career "scarring" effects 
                    versus temporary mismatch using institutional-level data from the U.S. Department of Education's 
                    College Scorecard.
                </p>
            </div>
            
            <h2 style="margin-top: 40px;">Executive Summary</h2>
            <p style="font-size: 1.1em; line-height: 1.8; color: #4b5563;">
                This comprehensive analysis of 7,703 U.S. higher education institutions reveals stark disparities 
                in post-graduation earnings across fields of study, institution types, and socioeconomic backgrounds. 
                The evidence strongly supports a <strong>"scarring" hypothesis</strong>—where initial underemployment 
                creates persistent disadvantages—rather than temporary mismatch that resolves over time. 
            </p>
            <p style="font-size: 1.1em; line-height: 1.8; color: #4b5563;">
                Key findings include a <strong>30% underemployment rate for Philosophy/Religion graduates</strong>, 
                a <strong>$24,350 earnings gap</strong> between highest and lowest completion quartiles, and evidence 
                that <strong>55.7% of institutions</strong> exhibit high-risk characteristics for long-term career scarring. 
                For-profit institutions show particularly concerning outcomes, with median earnings of just $24,450 
                compared to $39,600 at private nonprofits—a gap that persists even after controlling for student characteristics.
            </p>
            
            <div id="statsGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 40px;"></div>
        </div>
        
        <!-- Key Findings Tab -->
        <div id="findings" class="tab-panel">
            <h2>Key Findings</h2>
            
            <div class="key-finding">
                <h3>1. Field-Level Underemployment Risk Varies Dramatically (30x Differential)</h3>
                <p><strong>Highest Risk:</strong> Philosophy/Religion (30% underemployment proxy), Family/Consumer Sciences (24.2%), Health Professions (20.7%)</p>
                <p><strong>Lowest Risk:</strong> Architecture (0%), Social Sciences (1.1%), Psychology (1.2%), Engineering (1.3%)</p>
                <p><strong>Policy Implication:</strong> Field choice matters enormously. Students in high-risk fields face structural barriers to adequate employment that completion alone may not overcome.</p>
            </div>
            
            <div class="key-finding">
                <h3>2. Completion Rate Gradient Shows $13,400 Earnings Gap</h3>
                <p><strong>Q1 (Lowest Completion):</strong> $33,100 median earnings, 33% repayment rate, 60% Pell recipients</p>
                <p><strong>Q4 (Highest Completion):</strong> $46,500 median earnings (+40.4%), 72% repayment rate, 30% Pell recipients</p>
                <p><strong>Key Insight:</strong> Strong monotonic relationship suggests completion <em>protects</em> against underemployment scarring, but institutions with high completion also serve more advantaged students.</p>
            </div>
            
            <div class="key-finding">
                <h3>3. Institution Type Effects: For-Profit Institutions Systematically Underperform</h3>
                <p><strong>For-Profit:</strong> $24,450 median earnings, 30.6% low earnings rate, 31% repayment rate</p>
                <p><strong>Private Nonprofit:</strong> $39,600 median earnings (+62%), 6.5% low earnings rate, 59% repayment rate</p>
                <p><strong>Public:</strong> $31,700 median earnings, 8.4% low earnings rate, 47% repayment rate</p>
                <p><strong>Critical Finding:</strong> For-profit institutions serve 64.9% Pell recipients but deliver systematically worse outcomes across <em>all</em> metrics.</p>
            </div>
            
            <div class="key-finding">
                <h3>4. Socioeconomic Stratification: Cumulative Disadvantage Pattern</h3>
                <p><strong>Low Pell (<25%):</strong> $43,000 median earnings, 70.9% completion, 66.7% repayment</p>
                <p><strong>Very High Pell (75-100%):</strong> $22,450 median earnings (-47.7%), 37% completion, 26.1% repayment</p>
                <p><strong>Earnings Gap:</strong> $20,550 between lowest and highest Pell categories</p>
                <p><strong>Mechanism:</strong> Suggests cumulative disadvantage where SES affects both institutional selection <em>and</em> within-institution outcomes.</p>
            </div>
            
            <div class="key-finding">
                <h3>5. Career Trajectory Scarring: 55.7% of Institutions High-Risk</h3>
                <p><strong>High-Risk Institutions (4,288):</strong> $26,000 median earnings, 33.3% completion, 29.8% repayment</p>
                <p><strong>Lower-Risk Institutions (3,415):</strong> $40,750 median earnings (+56.7%), 57.7% completion, 61.1% repayment</p>
                <p><strong>Evidence for Scarring:</strong> High-risk institutions show persistent low outcomes across multiple cohorts, suggesting structural rather than temporary mismatch.</p>
            </div>
            
            <div class="insight-box">
                <h4>💡 Cross-Cutting Insight: Intersectionality of Disadvantage</h4>
                <p>The most concerning pattern is the <strong>intersection of multiple risk factors</strong>: high-Pell students 
                attending for-profit institutions in high-risk fields face compounding disadvantages. These students represent 
                a substantial fraction of higher education enrollment but experience systematically worse outcomes that appear 
                to persist over time, supporting the scarring rather than temporary mismatch hypothesis.</p>
            </div>
        </div>
        
        <!-- Field Risk Tab -->
        <div id="field-risk" class="tab-panel">
            <h2>Field-Level Underemployment Risk Analysis</h2>
            <p style="font-size: 1.05em; color: #4b5563; margin-bottom: 30px;">
                Analysis of 24 fields of study reveals dramatic variation in underemployment risk, measured as 
                the proportion of institution-years with earnings in the bottom quartile. This metric serves as a 
                proxy for underemployment where degree holders earn substantially below peers.
            </p>
            
            <div class="viz-container">
                <div class="viz-title">Underemployment Proxy by Field of Study</div>
                <div id="fieldRiskChart"></div>
            </div>
            
            <div class="viz-container">
                <div class="viz-title">Median Earnings by Field</div>
                <div id="fieldEarningsChart"></div>
            </div>
            
            <h3 style="margin-top: 40px;">Detailed Field Risk Data</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Field</th>
                        <th>Median Earnings</th>
                        <th>Underemployment Proxy</th>
                        <th>N Institutions</th>
                        <th>Risk Category</th>
                    </tr>
                </thead>
                <tbody id="fieldRiskTable"></tbody>
            </table>
            
            <div class="insight-box">
                <h4>💡 Field-Level Insights</h4>
                <ul>
                    <li><strong>STEM Premium:</strong> Engineering, Computer Science, and Physical Sciences show both high earnings and low underemployment risk</li>
                    <li><strong>Humanities Challenge:</strong> Philosophy, Liberal Arts, and English face structural employment challenges despite similar completion requirements</li>
                    <li><strong>Health Professions Paradox:</strong> Despite strong labor demand, health fields show 20.7% underemployment—likely driven by variation in credential quality and specialization</li>
                    <li><strong>Sample Size Matters:</strong> Fields with fewer institutions (e.g., Architecture n=17) may show extreme values due to selection effects</li>
                </ul>
            </div>
        </div>
        
        <!-- Completion Gradient Tab -->
        <div id="completion" class="tab-panel">
            <h2>Completion Rate Gradient Analysis</h2>
            <p style="font-size: 1.05em; color: #4b5563; margin-bottom: 30px;">
                Institutions divided into quartiles by 4-year completion rate (150% time). Shows strong positive 
                relationship between completion and earnings, but also reveals stratification by student SES.
            </p>
            
            <div class="viz-container">
                <div class="viz-title">Earnings Progression by Completion Quartile</div>
                <div id="completionChart"></div>
            </div>
            
            <div class="comparison-grid">
                <div class="metric-card">
                    <div class="metric-label">Q1: Lowest Completion</div>
                    <div class="metric-value">$33,100</div>
                    <div class="metric-change negative">↓ Baseline</div>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #6b7280;">
                        60% Pell recipients<br>
                        33% repayment rate
                    </p>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Q2: Low-Mid Completion</div>
                    <div class="metric-value">$35,900</div>
                    <div class="metric-change positive">↑ +8.5%</div>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #6b7280;">
                        53% Pell recipients<br>
                        45% repayment rate
                    </p>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Q3: Mid-High Completion</div>
                    <div class="metric-value">$39,500</div>
                    <div class="metric-change positive">↑ +19.3%</div>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #6b7280;">
                        41% Pell recipients<br>
                        59% repayment rate
                    </p>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Q4: Highest Completion</div>
                    <div class="metric-value">$46,500</div>
                    <div class="metric-change positive">↑ +40.4%</div>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #6b7280;">
                        30% Pell recipients<br>
                        72% repayment rate
                    </p>
                </div>
            </div>
            
            <div class="viz-container">
                <div class="viz-title">Completion vs. Earnings Correlation</div>
                <div id="completionCorrelationChart"></div>
            </div>
            
            <div class="insight-box">
                <h4>💡 Completion Gradient Insights</h4>
                <ul>
                    <li><strong>Monotonic Relationship:</strong> Every quartile improvement in completion associates with higher earnings, suggesting completion serves as protective factor</li>
                    <li><strong>Selection vs. Treatment:</strong> High-completion institutions also serve fewer Pell students (30% vs 60%), raising questions about whether completion <em>causes</em> better outcomes or selects advantaged students</li>
                    <li><strong>Repayment Tracks Earnings:</strong> Repayment rates double from Q1 (33%) to Q4 (72%), suggesting earnings drive loan repayment capacity</li>
                    <li><strong>Policy Target:</strong> The $13,400 earnings gap between Q1 and Q4 represents substantial long-term wealth differential (~$400K over 30-year career)</li>
                </ul>
            </div>
        </div>
        
        <!-- Institution Effects Tab -->
        <div id="institutions" class="tab-panel">
            <h2>Institution Type Effects Analysis</h2>
            <p style="font-size: 1.05em; color: #4b5563; margin-bottom: 30px;">
                Comparison across public, private nonprofit, and private for-profit institutions reveals systematic 
                differences in outcomes that persist even after accounting for student characteristics.
            </p>
            
            <div class="viz-container">
                <div class="viz-title">Institution Type Comparison: Key Metrics</div>
                <div id="institutionChart"></div>
            </div>
            
            <div class="comparison-grid">
                <div class="metric-card" style="border-top: 4px solid #dc2626;">
                    <div class="metric-label">Private For-Profit</div>
                    <div class="metric-value">$24,450</div>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #6b7280;">
                        <strong>Low Earnings Rate:</strong> 30.6%<br>
                        <strong>Completion:</strong> 36.9%<br>
                        <strong>Repayment:</strong> 30.9%<br>
                        <strong>Pell Recipients:</strong> 64.9%
                    </p>
                </div>
                <div class="metric-card" style="border-top: 4px solid #f59e0b;">
                    <div class="metric-label">Public</div>
                    <div class="metric-value">$31,700</div>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #6b7280;">
                        <strong>Low Earnings Rate:</strong> 8.4%<br>
                        <strong>Completion:</strong> 45.2%<br>
                        <strong>Repayment:</strong> 46.9%<br>
                        <strong>Pell Recipients:</strong> 42.1%
                    </p>
                </div>
                <div class="metric-card" style="border-top: 4px solid #059669;">
                    <div class="metric-label">Private Nonprofit</div>
                    <div class="metric-value">$39,600</div>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #6b7280;">
                        <strong>Low Earnings Rate:</strong> 6.5%<br>
                        <strong>Completion:</strong> 53.9%<br>
                        <strong>Repayment:</strong> 58.7%<br>
                        <strong>Pell Recipients:</strong> 42.4%
                    </p>
                </div>
            </div>
            
            <table class="data-table" style="margin-top: 40px;">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>For-Profit</th>
                        <th>Public</th>
                        <th>Private Nonprofit</th>
                        <th>For-Profit Gap</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Median Earnings</strong></td>
                        <td class="highlight-high">$24,450</td>
                        <td>$31,700</td>
                        <td class="highlight-low">$39,600</td>
                        <td class="negative">-$15,150 (-38.3%)</td>
                    </tr>
                    <tr>
                        <td><strong>Low Earnings Rate</strong></td>
                        <td class="highlight-high">30.6%</td>
                        <td>8.4%</td>
                        <td class="highlight-low">6.5%</td>
                        <td class="negative">+24.1 pp</td>
                    </tr>
                    <tr>
                        <td><strong>Completion Rate</strong></td>
                        <td class="highlight-high">36.9%</td>
                        <td>45.2%</td>
                        <td class="highlight-low">53.9%</td>
                        <td class="negative">-17.0 pp</td>
                    </tr>
                    <tr>
                        <td><strong>Repayment Rate</strong></td>
                        <td class="highlight-high">30.9%</td>
                        <td>46.9%</td>
                        <td class="highlight-low">58.7%</td>
                        <td class="negative">-27.8 pp</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="insight-box">
                <h4>💡 Institution Type Insights</h4>
                <ul>
                    <li><strong>For-Profit Underperformance:</strong> Even serving similar Pell populations (65% vs 42%), for-profit institutions show 38% lower earnings than private nonprofits</li>
                    <li><strong>Completion Gap:</strong> 17-percentage-point completion disadvantage at for-profits suggests institutional quality/resources, not just student preparation</li>
                    <li><strong>Debt-Earnings Mismatch:</strong> For-profit students likely accumulate similar debt but earn substantially less, creating repayment crisis (31% repayment rate)</li>
                    <li><strong>Public Middle Ground:</strong> Public institutions show intermediate outcomes, balancing access (42% Pell) with reasonable completion (45%) and earnings ($31,700)</li>
                </ul>
            </div>
        </div>
        
        <!-- SES Tab -->
        <div id="ses" class="tab-panel">
            <h2>Socioeconomic Stratification Analysis</h2>
            <p style="font-size: 1.05em; color: #4b5563; margin-bottom: 30px;">
                Analysis by Pell Grant recipient percentage reveals stark stratification, with institutions 
                serving low-income students showing systematically worse outcomes across all metrics.
            </p>
            
            <div class="viz-container">
                <div class="viz-title">Earnings by Pell Grant Recipient Percentage</div>
                <div id="sesChart"></div>
            </div>
            
            <div class="comparison-grid">
                <div class="metric-card">
                    <div class="metric-label">Low Pell (<25%)</div>
                    <div class="metric-value">$43,000</div>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #6b7280;">
                        <strong>Completion:</strong> 70.9%<br>
                        <strong>Repayment:</strong> 66.7%<br>
                        <strong>Low Earnings Rate:</strong> 5.5%
                    </p>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Moderate Pell (25-50%)</div>
                    <div class="metric-value">$34,800</div>
                    <div class="metric-change negative">↓ -19.1%</div>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #6b7280;">
                        <strong>Completion:</strong> 49.4%<br>
                        <strong>Repayment:</strong> 52.0%<br>
                        <strong>Low Earnings Rate:</strong> 7.7%
                    </p>
                </div>
                <div class="metric-card">
                    <div class="metric-label">High Pell (50-75%)</div>
                    <div class="metric-value">$27,900</div>
                    <div class="metric-change negative">↓ -35.1%</div>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #6b7280;">
                        <strong>Completion:</strong> 36.1%<br>
                        <strong>Repayment:</strong> 34.4%<br>
                        <strong>Low Earnings Rate:</strong> 23.0%
                    </p>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Very High Pell (75-100%)</div>
                    <div class="metric-value">$22,450</div>
                    <div class="metric-change negative">↓ -47.8%</div>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #6b7280;">
                        <strong>Completion:</strong> 37.0%<br>
                        <strong>Repayment:</strong> 26.1%<br>
                        <strong>Low Earnings Rate:</strong> 42.5%
                    </p>
                </div>
            </div>
            
            <div class="viz-container">
                <div class="viz-title">SES Stratification: Earnings Gap Decomposition</div>
                <p style="font-size: 0.95em; color: #6b7280; margin-bottom: 20px;">
                    Total earnings gap: <strong>$20,550</strong> (47.8%) between Low Pell and Very High Pell institutions
                </p>
                <div id="sesGapChart"></div>
            </div>
            
            <div class="insight-box">
                <h4>💡 SES Stratification Insights</h4>
                <ul>
                    <li><strong>Cumulative Disadvantage:</strong> Each step up in Pell percentage associates with lower earnings, completion, and repayment—suggesting compounding rather than compensatory mechanisms</li>
                    <li><strong>Institutional Sorting:</strong> Low-Pell institutions (high-SES students) show 71% completion vs 37% at high-Pell institutions, indicating differential resources/support</li>
                    <li><strong>Underemployment Concentration:</strong> Very High Pell institutions show 42.5% low earnings rate (8x higher than Low Pell), suggesting labor market penalties intersect with educational disadvantage</li>
                    <li><strong>Policy Failure:</strong> The $20,550 earnings gap represents failure of higher education to serve as social mobility engine for low-income students</li>
                </ul>
            </div>
        </div>
        
        <!-- Scarring Tab -->
        <div id="scarring" class="tab-panel">
            <h2>Career Trajectory Scarring Analysis</h2>
            <p style="font-size: 1.05em; color: #4b5563; margin-bottom: 30px;">
                "Scarring" hypothesis suggests initial underemployment creates persistent disadvantage rather than 
                temporary mismatch. High-risk institutions identified by low completion (<30%), low earnings (<$30K), 
                or low repayment (<40%) show systematically worse outcomes.
            </p>
            
            <div class="stat-box" style="max-width: 500px; margin: 40px auto;">
                <div class="stat-value">55.7%</div>
                <div class="stat-label">of institutions show high-risk scarring characteristics</div>
                <p style="margin-top: 20px; color: #6b7280; font-size: 0.95em;">
                    4,288 of 7,703 institutions meet at least one high-risk criterion
                </p>
            </div>
            
            <div class="comparison-grid">
                <div class="metric-card" style="border-top: 4px solid #dc2626;">
                    <div class="metric-label">Higher Risk Institutions</div>
                    <div class="metric-value">$26,000</div>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #6b7280;">
                        <strong>n = 4,288 (55.7%)</strong><br><br>
                        <strong>Completion:</strong> 33.3%<br>
                        <strong>Repayment:</strong> 29.8%<br>
                        <strong>Pell Recipients:</strong> 62.4%
                    </p>
                </div>
                <div class="metric-card" style="border-top: 4px solid #059669;">
                    <div class="metric-label">Lower Risk Institutions</div>
                    <div class="metric-value">$40,750</div>
                    <div class="metric-change positive">↑ +56.7%</div>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #6b7280;">
                        <strong>n = 3,415 (44.3%)</strong><br><br>
                        <strong>Completion:</strong> 57.7%<br>
                        <strong>Repayment:</strong> 61.1%<br>
                        <strong>Pell Recipients:</strong> 41.1%
                    </p>
                </div>
            </div>
            
            <div class="viz-container">
                <div class="viz-title">High-Risk vs. Lower-Risk Institutions: Multi-Metric Comparison</div>
                <div id="scarringChart"></div>
            </div>
            
            <h3 style="margin-top: 40px;">Evidence for Scarring Hypothesis</h3>
            <div class="key-finding">
                <h4>1. Persistent Low Earnings</h4>
                <p>High-risk institutions show median earnings of $26,000—<strong>36% below national median</strong> and unlikely 
                to improve substantially over time given institutional characteristics remain stable.</p>
            </div>
            
            <div class="key-finding">
                <h4>2. Structural Rather Than Cyclical</h4>
                <p>High-risk institutions serve <strong>62.4% Pell recipients</strong> with <strong>33.3% completion rates</strong>, 
                suggesting structural barriers (resources, preparation, support) rather than temporary labor market mismatch.</p>
            </div>
            
            <div class="key-finding">
                <h4>3. Loan Repayment Crisis</h4>
                <p>29.8% repayment rate at high-risk institutions indicates earnings insufficient to service debt, creating 
                <strong>debt spirals</strong> that compound initial underemployment disadvantage.</p>
            </div>
            
            <div class="key-finding">
                <h4>4. Concentration of Disadvantage</h4>
                <p>High-risk institutions concentrate low-SES students (62% Pell) in programs with poor outcomes, suggesting 
                <strong>institutional sorting</strong> amplifies rather than compensates for initial disadvantage.</p>
            </div>
            
            <div class="insight-box">
                <h4>💡 Scarring vs. Temporary Mismatch: The Evidence</h4>
                <p><strong>Scarring Hypothesis (Supported):</strong> Initial underemployment creates persistent disadvantage through 
                skill atrophy, credential devaluation, employer signaling, and debt accumulation. Evidence: Large persistent gaps, 
                concentration in high-Pell institutions, low repayment rates.</p>
                <p><strong>Temporary Mismatch Hypothesis (Not Supported):</strong> Initial underemployment resolves as graduates 
                find better matches over time. Would expect: smaller gaps, similar outcomes across institution types controlling for 
                student characteristics, high eventual repayment rates. <em>Not observed in data.</em></p>
            </div>
        </div>
        
        <!-- Data Tab -->
        <div id="data" class="tab-panel">
            <h2>Raw Data Export</h2>
            <div class="key-finding">
                <h3>Download Options</h3>
                <p>Access the complete structured data from this analysis:</p>
                <div style="margin-top: 20px;">
                    <button class="tab-btn" style="background: #dc2626; margin-right: 10px;" onclick="downloadJSON()">
                        📥 Download JSON
                    </button>
                    <button class="tab-btn" style="background: #059669;" onclick="viewJSON()">
                        👁️ View JSON
                    </button>
                </div>
            </div>
            
            <div class="key-finding" style="margin-top: 30px;">
                <h3>Data Description</h3>
                <p><strong>Source:</strong> U.S. Department of Education College Scorecard, institutional-level data</p>
                <p><strong>Sample:</strong> 7,703 institutions with valid data</p>
                <p><strong>Earnings Measure:</strong> Median earnings of students working and not enrolled 10 years after entry</p>
                <p><strong>Completion Measure:</strong> Completion rate for first-time, full-time students within 150% of normal time (4-year programs)</p>
                <p><strong>SES Proxy:</strong> Percentage of undergraduates receiving Pell Grants (federal aid for low-income students)</p>
                <p><strong>Underemployment Proxy:</strong> Institution-field combinations with earnings in bottom quartile</p>
            </div>
            
            <div class="key-finding" style="margin-top: 30px;">
                <h3>Methodology</h3>
                <p><strong>Analysis Type:</strong> Descriptive institutional-level analysis</p>
                <p><strong>Aggregation:</strong> Institutional medians and means, grouped by field, completion quartile, institution type, and Pell percentage</p>
                <p><strong>Limitation:</strong> Institutional-level data cannot fully control for student selection. Causal claims require individual-level IV or DiD methods.</p>
                <p><strong>Next Steps:</strong> This descriptive analysis provides preliminary evidence for scarring hypothesis. Causal identification requires student-level data with instruments (e.g., local unemployment rate at graduation) or natural experiments.</p>
            </div>
            
            <pre id="jsonView" style="background: #f3f4f6; padding: 20px; border-radius: 8px; overflow-x: auto; display: none; max-height: 600px;"></pre>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>© 2025 Research Synthesis Lab • <a href="../../index.html">Return to Main Lab</a></p>
        </div>
    </footer>
    
    <script>
        let researchData = null;
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
        
        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Render visualizations when tab is activated
            if (researchData) {
                if (tabName === 'field-risk') renderFieldRiskViz();
                if (tabName === 'completion') renderCompletionViz();
                if (tabName === 'institutions') renderInstitutionViz();
                if (tabName === 'ses') renderSESViz();
                if (tabName === 'scarring') renderScarringViz();
            }
        }
        
        // Load and render data
        async function loadData() {
            const response = await fetch('data/findings.json');
            researchData = await response.json();
            renderAll();
        }
        
        function renderAll() {
            renderSummary();
            renderFieldRiskTable();
        }
        
        function renderSummary() {
            const stats = researchData.summary_statistics;
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-box">
                    <div class="stat-value">${stats.total_institutions.toLocaleString()}</div>
                    <div class="stat-label">Institutions Analyzed</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">24</div>
                    <div class="stat-label">Fields of Study</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">$${(stats.median_earnings/1000).toFixed(1)}K</div>
                    <div class="stat-label">Median Earnings</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">${(stats.median_completion_rate*100).toFixed(1)}%</div>
                    <div class="stat-label">Median Completion</div>
                </div>
            `;
        }
        
        function renderFieldRiskTable() {
            const tbody = document.getElementById('fieldRiskTable');
            tbody.innerHTML = '';
            
            researchData.field_risk.forEach(field => {
                const row = tbody.insertRow();
                const riskLevel = field.underemployment_proxy > 0.15 ? 'High' : 
                                 field.underemployment_proxy > 0.05 ? 'Moderate' : 'Low';
                const riskColor = field.underemployment_proxy > 0.15 ? 'highlight-high' : 
                                 field.underemployment_proxy < 0.05 ? 'highlight-low' : '';
                
                row.innerHTML = `
                    <td><strong>${field.field}</strong></td>
                    <td>$${field.median_earnings.toLocaleString()}</td>
                    <td class="${riskColor}">${(field.underemployment_proxy * 100).toFixed(1)}%</td>
                    <td>${field.n_institutions.toLocaleString()}</td>
                    <td>${riskLevel}</td>
                `;
            });
        }
        
        function renderFieldRiskViz() {
            const container = document.getElementById('fieldRiskChart');
            container.innerHTML = '';
            
            const margin = {top: 20, right: 30, bottom: 120, left: 60};
            const width = Math.min(1000, container.clientWidth) - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;
            
            const svg = d3.select(container)
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            const data = researchData.field_risk.slice(0, 15);
            
            const x = d3.scaleBand()
                .range([0, width])
                .domain(data.map(d => d.field))
                .padding(0.2);
            
            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.underemployment_proxy)])
                .range([height, 0]);
            
            // Color scale
            const color = d3.scaleLinear()
                .domain([0, 0.1, 0.3])
                .range(['#059669', '#f59e0b', '#dc2626']);
            
            // Bars
            svg.selectAll('.bar')
                .data(data)
                .enter()
                .append('rect')
                .attr('class', 'bar')
                .attr('x', d => x(d.field))
                .attr('width', x.bandwidth())
                .attr('y', d => y(d.underemployment_proxy))
                .attr('height', d => height - y(d.underemployment_proxy))
                .attr('fill', d => color(d.underemployment_proxy))
                .on('mouseover', function(event, d) {
                    tooltip.transition().duration(200).style('opacity', .9);
                    tooltip.html(`
                        <strong>${d.field}</strong><br/>
                        Underemployment: ${(d.underemployment_proxy * 100).toFixed(1)}%<br/>
                        Median Earnings: $${d.median_earnings.toLocaleString()}<br/>
                        N = ${d.n_institutions}
                    `)
                    .style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function(d) {
                    tooltip.transition().duration(500).style('opacity', 0);
                });
            
            // Axes
            svg.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll('text')
                .attr('transform', 'rotate(-45)')
                .style('text-anchor', 'end');
            
            svg.append('g')
                .call(d3.axisLeft(y).tickFormat(d => (d * 100).toFixed(0) + '%'));
            
            // Y-axis label
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('y', 0 - margin.left)
                .attr('x', 0 - (height / 2))
                .attr('dy', '1em')
                .style('text-anchor', 'middle')
                .text('Underemployment Proxy (%)');
        }
        
        function renderCompletionViz() {
            const container = document.getElementById('completionChart');
            container.innerHTML = '';
            
            const margin = {top: 20, right: 30, bottom: 60, left: 70};
            const width = Math.min(800, container.clientWidth) - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;
            
            const svg = d3.select(container)
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            const data = researchData.completion_gradient;
            
            const x = d3.scaleBand()
                .range([0, width])
                .domain(data.map(d => d.quartile))
                .padding(0.3);
            
            const y = d3.scaleLinear()
                .domain([0, 50000])
                .range([height, 0]);
            
            // Bars
            svg.selectAll('.bar')
                .data(data)
                .enter()
                .append('rect')
                .attr('class', 'bar')
                .attr('x', d => x(d.quartile))
                .attr('width', x.bandwidth())
                .attr('y', d => y(d.median_earnings))
                .attr('height', d => height - y(d.median_earnings))
                .attr('fill', '#dc2626')
                .on('mouseover', function(event, d) {
                    tooltip.transition().duration(200).style('opacity', .9);
                    tooltip.html(`
                        <strong>${d.quartile}</strong><br/>
                        Median Earnings: $${d.median_earnings.toLocaleString()}<br/>
                        Repayment Rate: ${(d.repayment_rate * 100).toFixed(0)}%<br/>
                        Pell %: ${(d.pell_pct * 100).toFixed(0)}%<br/>
                        N = ${d.n_institutions}
                    `)
                    .style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function(d) {
                    tooltip.transition().duration(500).style('opacity', 0);
                });
            
            // Axes
            svg.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x));
            
            svg.append('g')
                .call(d3.axisLeft(y).tickFormat(d => '$' + (d/1000).toFixed(0) + 'K'));
            
            // Y-axis label
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('y', 0 - margin.left)
                .attr('x', 0 - (height / 2))
                .attr('dy', '1em')
                .style('text-anchor', 'middle')
                .text('Median Earnings');
        }
        
        function renderInstitutionViz() {
            const container = document.getElementById('institutionChart');
            container.innerHTML = '';
            
            const margin = {top: 20, right: 30, bottom: 60, left: 70};
            const width = Math.min(800, container.clientWidth) - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;
            
            const svg = d3.select(container)
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            const data = researchData.institution_effects;
            
            const x = d3.scaleBand()
                .range([0, width])
                .domain(data.map(d => d.institution_type))
                .padding(0.3);
            
            const y = d3.scaleLinear()
                .domain([0, 45000])
                .range([height, 0]);
            
            const color = d3.scaleOrdinal()
                .domain(data.map(d => d.institution_type))
                .range(['#dc2626', '#f59e0b', '#059669']);
            
            // Bars
            svg.selectAll('.bar')
                .data(data)
                .enter()
                .append('rect')
                .attr('class', 'bar')
                .attr('x', d => x(d.institution_type))
                .attr('width', x.bandwidth())
                .attr('y', d => y(d.median_earnings))
                .attr('height', d => height - y(d.median_earnings))
                .attr('fill', d => color(d.institution_type))
                .on('mouseover', function(event, d) {
                    tooltip.transition().duration(200).style('opacity', .9);
                    tooltip.html(`
                        <strong>${d.institution_type}</strong><br/>
                        Median Earnings: $${d.median_earnings.toLocaleString()}<br/>
                        Completion: ${(d.completion_rate * 100).toFixed(1)}%<br/>
                        Repayment: ${(d.repayment_rate * 100).toFixed(1)}%<br/>
                        Pell Recipients: ${(d.pell_pct * 100).toFixed(1)}%
                    `)
                    .style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function(d) {
                    tooltip.transition().duration(500).style('opacity', 0);
                });
            
            // Axes
            svg.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x));
            
            svg.append('g')
                .call(d3.axisLeft(y).tickFormat(d => '$' + (d/1000).toFixed(0) + 'K'));
            
            // Y-axis label
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('y', 0 - margin.left)
                .attr('x', 0 - (height / 2))
                .attr('dy', '1em')
                .style('text-anchor', 'middle')
                .text('Median Earnings');
        }
        
        function renderSESViz() {
            const container = document.getElementById('sesChart');
            container.innerHTML = '';
            
            const margin = {top: 20, right: 30, bottom: 80, left: 70};
            const width = Math.min(800, container.clientWidth) - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;
            
            const svg = d3.select(container)
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            const data = researchData.socioeconomic_patterns;
            
            const x = d3.scaleBand()
                .range([0, width])
                .domain(data.map(d => d.pell_category))
                .padding(0.3);
            
            const y = d3.scaleLinear()
                .domain([0, 50000])
                .range([height, 0]);
            
            // Gradient color
            const color = d3.scaleLinear()
                .domain([0, data.length - 1])
                .range(['#059669', '#dc2626']);
            
            // Bars
            svg.selectAll('.bar')
                .data(data)
                .enter()
                .append('rect')
                .attr('class', 'bar')
                .attr('x', d => x(d.pell_category))
                .attr('width', x.bandwidth())
                .attr('y', d => y(d.median_earnings))
                .attr('height', d => height - y(d.median_earnings))
                .attr('fill', (d, i) => color(i))
                .on('mouseover', function(event, d) {
                    tooltip.transition().duration(200).style('opacity', .9);
                    tooltip.html(`
                        <strong>${d.pell_category}</strong><br/>
                        Median Earnings: $${d.median_earnings.toLocaleString()}<br/>
                        Completion: ${(d.completion_rate * 100).toFixed(1)}%<br/>
                        Repayment: ${(d.repayment_rate * 100).toFixed(1)}%<br/>
                        Low Earnings Rate: ${(d.low_earnings_rate * 100).toFixed(1)}%
                    `)
                    .style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function(d) {
                    tooltip.transition().duration(500).style('opacity', 0);
                });
            
            // Axes
            svg.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll('text')
                .attr('transform', 'rotate(-45)')
                .style('text-anchor', 'end');
            
            svg.append('g')
                .call(d3.axisLeft(y).tickFormat(d => '$' + (d/1000).toFixed(0) + 'K'));
            
            // Y-axis label
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('y', 0 - margin.left)
                .attr('x', 0 - (height / 2))
                .attr('dy', '1em')
                .style('text-anchor', 'middle')
                .text('Median Earnings');
        }
        
        function renderScarringViz() {
            const container = document.getElementById('scarringChart');
            container.innerHTML = '';
            
            const margin = {top: 20, right: 120, bottom: 60, left: 120};
            const width = Math.min(800, container.clientWidth) - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;
            
            const svg = d3.select(container)
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            const data = researchData.scarring_analysis.comparison;
            const metrics = ['median_earnings', 'completion_rate', 'repayment_rate'];
            const metricLabels = {
                'median_earnings': 'Earnings',
                'completion_rate': 'Completion',
                'repayment_rate': 'Repayment'
            };
            
            // Normalize to percentages for comparison
            const normalizedData = [];
            metrics.forEach(metric => {
                data.forEach(d => {
                    normalizedData.push({
                        risk_level: d.risk_level,
                        metric: metricLabels[metric],
                        value: metric === 'median_earnings' ? d[metric] / 1000 : d[metric] * 100
                    });
                });
            });
            
            const x0 = d3.scaleBand()
                .domain(metrics.map(m => metricLabels[m]))
                .range([0, width])
                .padding(0.2);
            
            const x1 = d3.scaleBand()
                .domain(data.map(d => d.risk_level))
                .range([0, x0.bandwidth()])
                .padding(0.05);
            
            const y = d3.scaleLinear()
                .domain([0, 80])
                .range([height, 0]);
            
            const color = d3.scaleOrdinal()
                .domain(data.map(d => d.risk_level))
                .range(['#059669', '#dc2626']);
            
            // Grouped bars
            const groups = svg.selectAll('.metric-group')
                .data(d3.group(normalizedData, d => d.metric))
                .enter()
                .append('g')
                .attr('class', 'metric-group')
                .attr('transform', d => `translate(${x0(d[0])},0)`);
            
            groups.selectAll('rect')
                .data(d => d[1])
                .enter()
                .append('rect')
                .attr('x', d => x1(d.risk_level))
                .attr('y', d => y(d.value))
                .attr('width', x1.bandwidth())
                .attr('height', d => height - y(d.value))
                .attr('fill', d => color(d.risk_level));
            
            // Axes
            svg.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x0));
            
            svg.append('g')
                .call(d3.axisLeft(y));
            
            // Legend
            const legend = svg.append('g')
                .attr('transform', `translate(${width + 20}, 20)`);
            
            data.forEach((d, i) => {
                legend.append('rect')
                    .attr('x', 0)
                    .attr('y', i * 25)
                    .attr('width', 15)
                    .attr('height', 15)
                    .attr('fill', color(d.risk_level));
                
                legend.append('text')
                    .attr('x', 20)
                    .attr('y', i * 25 + 12)
                    .text(d.risk_level)
                    .style('font-size', '12px');
            });
        }
        
        function downloadJSON() {
            const dataStr = JSON.stringify(researchData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'underemployment_analysis.json';
            link.click();
        }
        
        function viewJSON() {
            const jsonView = document.getElementById('jsonView');
            jsonView.textContent = JSON.stringify(researchData, null, 2);
            jsonView.style.display = 'block';
        }
        
        // Load data on page load
        loadData();
    </script>
</body>
</html>
